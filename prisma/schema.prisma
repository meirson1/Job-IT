generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum GlobalRole {
  USER
  ADMIN
}

enum CompanyRole {
  OWNER
  HR
  RECRUITER
}

enum ApplicationStatus {
  SUBMITTED
  IN_REVIEW
  INTERVIEW
  REJECTED
  HIRED
}

enum JobSource {
  LINKEDIN
  COMPANY_SITE
  GREENHOUSE
  LEVER
  INDEED
  OTHER
}

enum WorkplaceType {
  ONSITE
  HYBRID
  REMOTE
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERN
  TEMP
}

enum ExperienceLevel {
  INTERN
  JUNIOR
  MID
  SENIOR
  LEAD
}

model User {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String

  GlobalRole GlobalRole @default(USER)

  companyId   Int?
  companyRole CompanyRole?
  company     Company?     @relation(fields: [companyId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  applications   Application[]
  savedJobs      SavedJob[]
  companyMembers CompanyMember[]
}

model Company {
  id      Int     @id @default(autoincrement())
  name    String  @unique
  website String?
  logoUrl String?

  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  jobs      Job[]
  members   CompanyMember[]
  users     User[]
}

model CompanyMember {
  id        Int         @id @default(autoincrement())
  userId    Int
  companyId Int
  role      CompanyRole

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, companyId])
  @@index([companyId])
}

model Job {
  id Int @id @default(autoincrement())

  companyId Int
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  title            String
  description      String
  requirements     String?
  responsibilities String?
  benefits         String?

  location        String?
  workplaceType   WorkplaceType?
  employmentType  EmploymentType?
  experienceLevel ExperienceLevel?
  promoted        Boolean          @default(false)
  easyApply       Boolean          @default(false)

  source     JobSource
  externalId String?
  url        String?
  applyUrl   String?

  salaryMin      Int?
  salaryMax      Int?
  salaryCurrency String?

  postedAt  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  tags         String[]      @default([])
  applications Application[]
  savedBy      SavedJob[]

  @@unique([source, externalId])
  @@index([companyId])
  @@index([source])
}

model Application {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  jobId Int
  job   Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  status      ApplicationStatus @default(SUBMITTED)
  coverLetter String?
  resumeUrl   String?
  notes       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, jobId])
  @@index([jobId])
  @@index([userId])
}

model SavedJob {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  jobId Int
  job   Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, jobId])
  @@index([jobId])
}

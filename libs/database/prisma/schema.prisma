generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

enum GlobalRole {
  USER
  ADMIN
  RECRUITER
}

enum ApplicationStatus {
  SUBMITTED
  IN_REVIEW
  INTERVIEW
  REJECTED
  CLOSED
}

enum JobSource {
  LINKEDIN
  COMPANY_SITE
  GREENHOUSE
  LEVER
  INDEED
  OTHER
}

enum WorkplaceType {
  ONSITE
  HYBRID
  REMOTE
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERN
  TEMP
}

enum ExperienceLevel {
  INTERN
  JUNIOR
  MID
  SENIOR
  LEAD
}

enum JobRole {
  FULLSTACK
  FRONTEND
  BACKEND
  DATA_ENGINEER
  DATA_SCIENTIST
  DEVOPS
  QA
  MOBILE
  PRODUCT
  SECURITY
  OTHER
}

model User {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String

  GlobalRole GlobalRole @default(USER)

  companyId Int?
  company   Company? @relation(fields: [companyId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  applications   Application[]
  savedJobs      SavedJob[]
  companyMembers CompanyMember[]
}

model Company {
  id      Int     @id @default(autoincrement())
  name    String  @unique
  website String?
  logoUrl String?

  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  jobs      Job[]
  members   CompanyMember[]
  users     User[]
}

model CompanyMember {
  id        Int @id @default(autoincrement())
  userId    Int
  companyId Int

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, companyId])
  @@index([companyId])
}

model Job {
  id Int @id @default(autoincrement())

  companyId Int?
  company   Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  title            String
  description      String
  requirements     String
  responsibilities String
  benefits         String?

  location        String
  workplaceType   WorkplaceType
  employmentType  EmploymentType
  experienceLevel ExperienceLevel
  promoted        Boolean         @default(false)

  source JobSource
  url    String

  salaryMin      Int?
  salaryMax      Int?
  salaryCurrency String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  role         JobRole[]
  applications Application[]
  savedBy      SavedJob[]

  @@unique([source, url], name: "source_url")
  @@index([companyId])
}

model Application {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  jobId Int
  job   Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  status      ApplicationStatus @default(SUBMITTED)
  coverLetter String?
  resumeUrl   String?
  notes       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, jobId])
  @@index([jobId])
  @@index([userId])
}

model SavedJob {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  jobId Int
  job   Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, jobId])
  @@index([jobId])
}
